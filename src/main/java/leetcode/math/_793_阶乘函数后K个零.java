package leetcode.math;
//f(x) æ˜¯ x! æœ«å°¾æ˜¯ 0 çš„æ•°é‡ã€‚å›æƒ³ä¸€ä¸‹ x! = 1 * 2 * 3 * ... * xï¼Œä¸” 0! = 1 ã€‚
//
//
// ä¾‹å¦‚ï¼Œ f(3) = 0 ï¼Œå› ä¸º 3! = 6 çš„æœ«å°¾æ²¡æœ‰ 0 ï¼›è€Œ f(11) = 2 ï¼Œå› ä¸º 11!= 39916800 æœ«ç«¯æœ‰ 2 ä¸ª 0 ã€‚
//
//
// ç»™å®š kï¼Œæ‰¾å‡ºè¿”å›èƒ½æ»¡è¶³ f(x) = k çš„éè´Ÿæ•´æ•° x çš„æ•°é‡ã€‚
//
//
//
// ç¤ºä¾‹ 1ï¼š
//
//
//è¾“å…¥ï¼šk = 0
//è¾“å‡ºï¼š5
//è§£é‡Šï¼š0!, 1!, 2!, 3!, å’Œ 4!Â å‡ç¬¦åˆ k = 0 çš„æ¡ä»¶ã€‚
//
//
// ç¤ºä¾‹ 2ï¼š
//
//
//è¾“å…¥ï¼šk = 5
//è¾“å‡ºï¼š0
//è§£é‡Šï¼šæ²¡æœ‰åŒ¹é…åˆ°è¿™æ ·çš„ x!ï¼Œç¬¦åˆ k = 5 çš„æ¡ä»¶ã€‚
//
// ç¤ºä¾‹ 3:
//
//
//è¾“å…¥: k = 3
//è¾“å‡º: 5
//
//
//
//
// æç¤º:
//
//
// 0 <= k <= 10â¹
//
//
// Related Topics æ•°å­¦ äºŒåˆ†æŸ¥æ‰¾ ğŸ‘ 90 ğŸ‘ 0

/**
 * @see _172_é˜¶ä¹˜åçš„é›¶
 * @author mayanwei
 * @date 2022-08-05.
 */
public class _793_é˜¶ä¹˜å‡½æ•°åKä¸ªé›¶{
    class Solution{
        // æ¯”è¾ƒç›´è§‚çš„å°±æ˜¯ç©·ä¸¾
        // å¯¹äºè¿™ç§å…·æœ‰å•è°ƒæ€§çš„å‡½æ•°ï¼Œç”¨ for å¾ªç¯éå†ï¼Œå¯ä»¥ç”¨äºŒåˆ†æŸ¥æ‰¾è¿›è¡Œé™ç»´æ‰“å‡»
        // æœç´¢æœ‰å¤šå°‘ä¸ª n æ»¡è¶³ trailingZeroes(n) == Kï¼Œå…¶å®å°±æ˜¯åœ¨é—®ï¼Œæ»¡è¶³æ¡ä»¶çš„ n æœ€å°æ˜¯å¤šå°‘ï¼Œæœ€å¤§æ˜¯å¤šå°‘ï¼Œæœ€å¤§å€¼å’Œæœ€å°å€¼ä¸€å‡ï¼Œ
        // å°±å¯ä»¥ç®—å‡ºæ¥æœ‰å¤šå°‘ä¸ª n æ»¡è¶³æ¡ä»¶äº†ï¼Œå¯¹å§ï¼Ÿé‚£ä¸å°±æ˜¯ äºŒåˆ†æŸ¥æ‰¾ ä¸­ã€Œæœç´¢å·¦ä¾§è¾¹ç•Œã€å’Œã€Œæœç´¢å³ä¾§è¾¹ç•Œã€è¿™ä¸¤ä¸ªäº‹å„¿å˜›ï¼Ÿ
        // è¿™é“é¢˜ç›®å®é™…ä¸Šç»™äº†é™åˆ¶ï¼ŒK æ˜¯åœ¨ [0, 10^9] åŒºé—´å†…çš„æ•´æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒtrailingZeroes(n) çš„ç»“æœæœ€å¤šå¯ä»¥è¾¾åˆ° 10^9ã€‚
        //
        // ç¡®å®šä¸Šä¸‹ç•Œ [0,LONG_MAX]
        // ç„¶åæˆ‘ä»¬å¯ä»¥åæ¨ï¼Œå½“ trailingZeroes(n) ç»“æœä¸º 10^9 æ—¶ï¼Œn ä¸ºå¤šå°‘ï¼Ÿè¿™ä¸ªä¸éœ€è¦ä½ ç²¾ç¡®è®¡ç®—å‡ºæ¥ï¼Œä½ åªè¦æ‰¾åˆ°ä¸€ä¸ªæ•° hiï¼Œ
        // ä½¿å¾— trailingZeroes(hi) æ¯” 10^9 å¤§ï¼Œå°±å¯ä»¥æŠŠ hi å½“åšæ­£æ— ç©·ï¼Œä½œä¸ºæœç´¢åŒºé—´çš„ä¸Šç•Œã€‚

        // åˆšæ‰è¯´äº†ï¼ŒtrailingZeroes å‡½æ•°æ˜¯å•è°ƒå‡½æ•°ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥çŒœï¼Œå…ˆç®—ä¸€ä¸‹ trailingZeroes(INT_MAX) çš„ç»“æœï¼Œæ¯” 10^9 å°ä¸€äº›ï¼Œ
        // é‚£å†ç”¨ LONG_MAX ç®—ä¸€ä¸‹ï¼Œè¿œè¶… 10^9 äº†ï¼Œæ‰€ä»¥ LONG_MAX å¯ä»¥ä½œä¸ºæœç´¢çš„ä¸Šç•Œã€‚

        // æ³¨æ„ä¸ºäº†é¿å…æ•´å‹æº¢å‡ºçš„é—®é¢˜ï¼ŒtrailingZeroes å‡½æ•°éœ€è¦æŠŠæ‰€æœ‰æ•°æ®ç±»å‹æ”¹æˆ long
        // æ—¶é—´å¤æ‚åº¦ä¸»è¦æ˜¯äºŒåˆ†æœç´¢ï¼Œä»æ•°å€¼ä¸Šæ¥è¯´ LONG_MAX æ˜¯ 2^63 - 1ï¼Œå¤§å¾—ç¦»è°±ï¼Œä½†æ˜¯äºŒåˆ†æœç´¢æ˜¯å¯¹æ•°çº§çš„å¤æ‚åº¦ï¼Œ
        // log(LONG_MAX) æ˜¯ä¸€ä¸ªå¸¸æ•°ï¼›æ¯æ¬¡äºŒåˆ†çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨ä¸€æ¬¡ trailingZeroes å‡½æ•°ï¼Œå¤æ‚åº¦ O(logK)ï¼›æ‰€ä»¥æ€»ä½“çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ O(logK)ã€‚
        public int preimageSizeFZF(int k) {
            // å·¦è¾¹ç•Œå’Œå³è¾¹ç•Œä¹‹å·® + 1å°±æ˜¯ç­”æ¡ˆ
            return (int) (right_bound(k) - left_bound(k) + 1);
        }

        // æœç´¢ trailingZeroes(n) == K çš„å·¦ä¾§è¾¹ç•Œ
        long right_bound(int target) {
            long lo = 0, hi = Long.MAX_VALUE;
            while (lo < hi) {
                long mid = lo + ((hi - lo) >> 1);
                long v = trailingZeroes(mid);
                if (v < target) {
                    lo = mid + 1;
                }
                else if (v > target) {
                    hi = mid;
                }
                else {
                    lo = mid + 1;
                }
            }
            return lo - 1;
        }

        long left_bound(int target) {
            long lo = 0, hi = Long.MAX_VALUE;
            while (lo < hi) {
                long mid = lo + ((hi - lo) >> 1);
                long v = trailingZeroes(mid);
                if (v < target) {
                    lo = mid + 1;
                }
                else if (v > target) {
                    hi = mid;
                }
                else {
                    hi = mid;
                }
            }
            return lo;
        }

        // ä¸ºé¿å…ä¸€å¤„çš„é—®é¢˜ï¼Œè¯¥å‡½æ•°æŠŠæ‰€æœ‰æ•°æ®ç±»å‹æ”¹æˆlong
        private long trailingZeroes(long n) {
            long res = 0;
            for (long d = n; d / 5 > 0; d = d / 5) {
                res += d / 5;
            }
            return res;
        }
    }
}
