package leetcode.dp;
//ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² s å’Œä¸€ä¸ªå­—ç¬¦è§„å¾‹ pï¼Œè¯·ä½ æ¥å®ç°ä¸€ä¸ªæ”¯æŒ '.' å’Œ '*' çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…ã€‚
//
//
// '.' åŒ¹é…ä»»æ„å•ä¸ªå­—ç¬¦
// '*' åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ 
//
//
// æ‰€è°“åŒ¹é…ï¼Œæ˜¯è¦æ¶µç›– æ•´ä¸ª å­—ç¬¦ä¸² sçš„ï¼Œè€Œä¸æ˜¯éƒ¨åˆ†å­—ç¬¦ä¸²ã€‚
//
//
// ç¤ºä¾‹ 1ï¼š
//
//
//è¾“å…¥ï¼šs = "aa" p = "a"
//è¾“å‡ºï¼šfalse
//è§£é‡Šï¼š"a" æ— æ³•åŒ¹é… "aa" æ•´ä¸ªå­—ç¬¦ä¸²ã€‚
//
//
// ç¤ºä¾‹ 2:
//
//
//è¾“å…¥ï¼šs = "aa" p = "a*"
//è¾“å‡ºï¼štrue
//è§£é‡Šï¼šå› ä¸º '*' ä»£è¡¨å¯ä»¥åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªå‰é¢çš„é‚£ä¸€ä¸ªå…ƒç´ , åœ¨è¿™é‡Œå‰é¢çš„å…ƒç´ å°±æ˜¯ 'a'ã€‚å› æ­¤ï¼Œå­—ç¬¦ä¸² "aa" å¯è¢«è§†ä¸º 'a' é‡å¤äº†ä¸€æ¬¡ã€‚
//
//
// ç¤ºä¾‹ 3ï¼š
//
//
//è¾“å…¥ï¼šs = "ab" p = ".*"
//è¾“å‡ºï¼štrue
//è§£é‡Šï¼š".*" è¡¨ç¤ºå¯åŒ¹é…é›¶ä¸ªæˆ–å¤šä¸ªï¼ˆ'*'ï¼‰ä»»æ„å­—ç¬¦ï¼ˆ'.'ï¼‰ã€‚
//
//
// ç¤ºä¾‹ 4ï¼š
//
//
//è¾“å…¥ï¼šs = "aab" p = "c*a*b"
//è¾“å‡ºï¼štrue
//è§£é‡Šï¼šå› ä¸º '*' è¡¨ç¤ºé›¶ä¸ªæˆ–å¤šä¸ªï¼Œè¿™é‡Œ 'c' ä¸º 0 ä¸ª, 'a' è¢«é‡å¤ä¸€æ¬¡ã€‚å› æ­¤å¯ä»¥åŒ¹é…å­—ç¬¦ä¸² "aab"ã€‚
//
//
// ç¤ºä¾‹ 5ï¼š
//
//
//è¾“å…¥ï¼šs = "mississippi" p = "mis*is*p*."
//è¾“å‡ºï¼šfalse
//
//
//
// æç¤ºï¼š
//
//
// 1 <= s.length <= 20
// 1 <= p.length <= 30
// s å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ã€‚
// p å¯èƒ½ä¸ºç©ºï¼Œä¸”åªåŒ…å«ä» a-z çš„å°å†™å­—æ¯ï¼Œä»¥åŠå­—ç¬¦ . å’Œ *ã€‚
// ä¿è¯æ¯æ¬¡å‡ºç°å­—ç¬¦ * æ—¶ï¼Œå‰é¢éƒ½åŒ¹é…åˆ°æœ‰æ•ˆçš„å­—ç¬¦
//
// Related Topics å­—ç¬¦ä¸² åŠ¨æ€è§„åˆ’ å›æº¯ç®—æ³•
// ğŸ‘ 1701 ğŸ‘ 0
import org.junit.Assert;
import org.junit.jupiter.api.Test;

public class _10_æ­£åˆ™è¡¨è¾¾å¼åŒ¹é… {

    /**
     * åˆ†æï¼š
     * ç”¨f[i][j] è¡¨ç¤ºsçš„å‰iä¸ªå­—ç¬¦ä¸pä¸­çš„å‰jä¸ªå­—ç¬¦æ˜¯å¦åŒ¹é…ã€‚åœ¨çŠ¶æ€è½¬ç§»æ—¶ï¼Œè€ƒè™‘pçš„ç¬¬jä¸ªå­—ç¬¦çš„åŒ¹é…æƒ…å†µï¼š
     *
     * 1. p[j] != '*'
     *       f[i][j] = matches(s[i],p[j])  ? f[i-1][j-1] : false
     * 2. p[j] == '*'
     *      f[i][j] = matches(s[i], p[j-1]) ? (f[i-1][j] or f[i][j-2]) : f[i][j-2]
     * åˆå§‹çŠ¶æ€ f[0][0] = true,è¡¨ç¤ºç©ºå­—ç¬¦ä¸²ä¸ºtrueï¼Œæœ€ç»ˆçš„ç­”æ¡ˆä¸ºf[m][n]
     *
     * ç©ºé—´å¤æ‚åº¦ O(m*n)
     * æ—¶é—´å¤æ‚åº¦ O(n*n)
     */
    static class Solution {
        public boolean isMatch(String s, String p) {
            int m = s.length(), n = p.length();
            boolean[][] f = new boolean[m + 1][n + 1];
            f[0][0] = true;
            for(int i = 0; i <= m; i++){
                for(int j = 1; j<= n; j++){
                    if(p.charAt(j - 1) == '*'){
                        f[i][j] = f[i][j-2];
                        if(matches(s, p, i, j-1)){
                            f[i][j] = f[i][j] ||  f[i-1][j];
                        }
                    }else{
                        if(matches(s, p, i, j)){
                            f[i][j] = f[i-1][j-1];
                        }
                    }
                }
            }
            return f[m][n];
        }

        private boolean matches(String s, String p, int i, int j) {
            if(i == 0){
                return false;
            }
            if(p.charAt(j-1) == '.'){
                return true;
            }
            return s.charAt(i-1) == p.charAt(j-1);
        }
    }
    /**
     * ä»¥ä¸€ä¸ªä¾‹å­è¯¦è§£åŠ¨æ€è§„åˆ’è½¬ç§»æ–¹ç¨‹ï¼š
     * S = abbbbc
     * P = ab*d*c
     * 1. å½“ i, j æŒ‡å‘çš„å­—ç¬¦å‡ä¸ºå­—æ¯ï¼ˆæˆ– '.' å¯ä»¥çœ‹æˆä¸€ä¸ªç‰¹æ®Šçš„å­—æ¯ï¼‰æ—¶ï¼Œ
     *    åªéœ€åˆ¤æ–­å¯¹åº”ä½ç½®çš„å­—ç¬¦å³å¯ï¼Œ
     *    è‹¥ç›¸ç­‰ï¼Œåªéœ€åˆ¤æ–­ i,j ä¹‹å‰çš„å­—ç¬¦ä¸²æ˜¯å¦åŒ¹é…å³å¯ï¼Œè½¬åŒ–ä¸ºå­é—®é¢˜ f[i-1][j-1].
     *    è‹¥ä¸ç­‰ï¼Œåˆ™å½“å‰çš„ i,j è‚¯å®šä¸èƒ½åŒ¹é…ï¼Œä¸º false.
     *
     *        f[i-1][j-1]   i
     *             |        |
     *    S [a  b  b  b  b][c]
     *
     *    P [a  b  *  d  *][c]
     *                      |
     *                      j
     *
     *
     * 2. å¦‚æœå½“å‰ j æŒ‡å‘çš„å­—ç¬¦ä¸º '*'ï¼Œåˆ™ä¸å¦¨æŠŠç±»ä¼¼ 'a*', 'b*' ç­‰çš„å½“æˆæ•´ä½“çœ‹å¾…ã€‚
     *    çœ‹ä¸‹é¢çš„ä¾‹å­
     *
     *             i
     *             |
     *    S  a  b [b] b  b  c
     *
     *    P  a [b  *] d  *  c
     *             |
     *             j
     *
     *    æ³¨æ„åˆ°å½“ 'b*' åŒ¹é…å®Œ 'b' ä¹‹åï¼Œå®ƒä»ç„¶å¯ä»¥ç»§ç»­å‘æŒ¥ä½œç”¨ã€‚
     *    å› æ­¤å¯ä»¥åªæŠŠ i å‰ç§»ä¸€ä½ï¼Œè€Œä¸ä¸¢å¼ƒ 'b*', è½¬åŒ–ä¸ºå­é—®é¢˜ f[i-1][j]:
     *
     *          i
     *          | <--
     *    S  a [b] b  b  b  c
     *
     *    P  a [b  *] d  *  c
     *             |
     *             j
     *
     *    å¦å¤–ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©è®© 'b*' ä¸å†è¿›è¡ŒåŒ¹é…ï¼ŒæŠŠ 'b*' ä¸¢å¼ƒã€‚
     *    è½¬åŒ–ä¸ºå­é—®é¢˜ f[i][j-2]:
     *
     *             i
     *             |
     *    S  a  b [b] b  b  c
     *
     *    P [a] b  *  d  *  c
     *       |
     *       j <--
     *
     * 3. å†—ä½™çš„çŠ¶æ€è½¬ç§»ä¸ä¼šå½±å“ç­”æ¡ˆï¼Œ
     *    å› ä¸ºå½“ j æŒ‡å‘ 'b*' ä¸­çš„ 'b' æ—¶, è¿™ä¸ªçŠ¶æ€å¯¹äºç­”æ¡ˆæ˜¯æ²¡æœ‰ç”¨çš„,
     *    å½“ j æŒ‡å‘ '*' æ—¶,
     *    dp[i][j]åªä¸dp[i][j-2]æœ‰å…³, è·³è¿‡äº† dp[i][j-1].
     */



    class Solution3 {
        public boolean isMatch(String s, String p) {
            if (s == null && p == null){
                return true;
            }
            if ((s!=null && p ==null )|| (s== null && p!=null)){
                return false;
            }
            int m = s.length();
            int n = p.length();

            // dp[i][j] è¡¨ç¤º s å‰ i ä½å’Œ p å‰ j ä½æ˜¯å¦åŒ¹é…ï¼Œ è¿™æ · dp[m][n] è¡¨ç¤º s å’Œ p æ˜¯å¦åŒ¹é…
            boolean dp[][] = new boolean[m+1][n+1];
            // åˆå§‹çŠ¶æ€è®¾ç½®
            // 1. å½“ s å’Œ p éƒ½æ˜¯ç©ºä¸²çš„æ—¶å€™true
            dp[0][0] = true;
            // 2. ä¸‹é¢ä¸¤ä¸ªforå¾ªç¯åˆ†åˆ«è¡¨ç¤ºå½“ s ä¸ºç©ºå’Œ p ä¸ºç©ºçš„æƒ…å†µ
            // for (int i = 1; i<= m; i++) {
            //     dp[i][0] = false;
            // }

            for (int j = 1; j < dp[0].length; j++) {
                char ch = p.charAt(j-1);
                if (j > 1) {
                    if (ch == '*') {
                        dp[0][j] = dp[0][j-2];
                    } else {
                        dp[0][j] = false;
                    }
                } else {
                    if (ch == '*') {
                        dp[0][j] = true;
                    }
                }
            }
            for (int row = 1; row<dp.length; row++){
                char ch1 = s.charAt(row-1);
                for(int col = 1; col<dp[row].length; col++) {
                    char ch2 = p.charAt(col-1);
                    if (ch1 == ch2 || ch2 == '.') {
                        dp[row][col] = dp[row-1][col-1];
                    }
                    else if (ch2 == '*') {
                        if (col > 1) {
                            if (dp[row][col-2]) {
                                dp[row][col] = true;
                            }
                            else{
                                char prev = p.charAt(col-2);
                                if (prev == ch1 || prev=='.') {
                                    dp[row][col] = dp[row-1][col];
                                }
                            }
                        }
                    }
                    // else {
                    //     dp[row][col] = false;
                    // }
                }
            }
            return dp[m][n];
        }
    }
    @Test
    void testSolution(){
        Solution solution1 = new Solution();
        Assert.assertTrue(solution1.isMatch("a",".*"));
        Solution3 solution = new Solution3();
        Assert.assertEquals(true, solution.isMatch("aab","c*a*b"));
        Assert.assertEquals(true, solution.isMatch("a",".*"));
    }
}
