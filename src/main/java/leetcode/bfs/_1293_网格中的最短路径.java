package leetcode.bfs;
//ç»™ä½ ä¸€ä¸ª m * n çš„ç½‘æ ¼ï¼Œå…¶ä¸­æ¯ä¸ªå•å…ƒæ ¼ä¸æ˜¯ 0ï¼ˆç©ºï¼‰å°±æ˜¯ 1ï¼ˆéšœç¢ç‰©ï¼‰ã€‚æ¯ä¸€æ­¥ï¼Œæ‚¨éƒ½å¯ä»¥åœ¨ç©ºç™½å•å…ƒæ ¼ä¸­ä¸Šã€ä¸‹ã€å·¦ã€å³ç§»åŠ¨ã€‚
//
// å¦‚æœæ‚¨ æœ€å¤š å¯ä»¥æ¶ˆé™¤ k ä¸ªéšœç¢ç‰©ï¼Œè¯·æ‰¾å‡ºä»å·¦ä¸Šè§’ (0, 0) åˆ°å³ä¸‹è§’ (m-1, n-1) çš„æœ€çŸ­è·¯å¾„ï¼Œå¹¶è¿”å›é€šè¿‡è¯¥è·¯å¾„æ‰€éœ€çš„æ­¥æ•°ã€‚å¦‚æœæ‰¾ä¸åˆ°è¿™æ ·
//çš„è·¯å¾„ï¼Œåˆ™è¿”å› -1 ã€‚
//
//
//
// ç¤ºä¾‹ 1ï¼š
//
//
//
//
//è¾“å…¥ï¼š grid = [[0,0,0],[1,1,0],[0,0,0],[0,1,1],[0,0,0]], k = 1
//è¾“å‡ºï¼š6
//è§£é‡Šï¼š
//ä¸æ¶ˆé™¤ä»»ä½•éšœç¢çš„æœ€çŸ­è·¯å¾„æ˜¯ 10ã€‚
//æ¶ˆé™¤ä½ç½® (3,2) å¤„çš„éšœç¢åï¼Œæœ€çŸ­è·¯å¾„æ˜¯ 6 ã€‚è¯¥è·¯å¾„æ˜¯ (0,0) -> (0,1) -> (0,2) -> (1,2) -> (2,2) -> (3
//,2) -> (4,2).
//
//
// ç¤ºä¾‹ 2ï¼š
//
//
//
//
//è¾“å…¥ï¼šgrid = [[0,1,1],[1,1,1],[1,0,0]], k = 1
//è¾“å‡ºï¼š-1
//è§£é‡Šï¼šæˆ‘ä»¬è‡³å°‘éœ€è¦æ¶ˆé™¤ä¸¤ä¸ªéšœç¢æ‰èƒ½æ‰¾åˆ°è¿™æ ·çš„è·¯å¾„ã€‚
//
//
//
//
// æç¤ºï¼š
//
//
// grid.length == m
// grid[0].length == n
// 1 <= m, n <= 40
// 1 <= k <= m*n
// grid[i][j] æ˜¯ 0 æˆ– 1
// grid[0][0] == grid[m-1][n-1] == 0
//
//
// Related Topics å¹¿åº¦ä¼˜å…ˆæœç´¢ æ•°ç»„ çŸ©é˜µ ğŸ‘ 204 ğŸ‘ 0


import java.util.Arrays;
import java.util.LinkedList;
import java.util.Queue;

/**
 * @author mayanwei
 * @date 2022-09-05.
 */
public class _1293_ç½‘æ ¼ä¸­çš„æœ€çŸ­è·¯å¾„{
    class Solution{
        public int shortestPath(int[][] grid, int k) {
            int m = grid.length;
            int n = grid[0].length;
            // éæ³•å‚æ•°å¤„ç†
            if (validateInputParams(k, m, n)) {
                return -1;
            }
            // ç‰¹æ®Šåœºæ™¯å¤„ç†
            if (m == 1 && n == 1) {
                return 0;
            }
            // äºŒç»´æ ‡è®°æ•°ç»„åˆå§‹çŠ¶æ€ä¸º-1ï¼Œå€¼è®°å½•å‰©ä½™æ¶ˆé™¤éšœç¢çš„æ¬¡æ•°ï¼Œå‰©ä½™æ¬¡æ•°è¶Šå¤šï¼Œè¶Šæœ‰ä»·å€¼ï¼ˆæ­¤å¤„è´ªå¿ƒï¼Œè®°å½•å±€éƒ¨æœ€ä¼˜è§£ï¼‰
            int[][] visited = new int[m][n];
            for (int i = 0; i < m; i++) {
                Arrays.fill(visited[i], -1);
            }
            //åˆå§‹æ­¥æ•°ä¸º0ï¼Œ m = n = 1çš„ç‰¹æ®Šåœºæ™¯å·²ç»å¤„ç†
            int minSteps = 0;
            // åˆå§‹ä½ç½®æ ‡è®°å·²è®¿é—®ï¼Œå€¼è®°å½•å‰©ä½™æ¶ˆé™¤éšœç¢ç‰©æ¬¡æ•° è¶Šå¤šè¶Šå¥½
            // 1. å¯¹äºå…¶ä»–è·¯å¾„åˆ°è¾¾æ­¤ç‚¹ï¼Œä¸”å‰©ä½™æ¶ˆé™¤éšœç¢ç‰©æ¬¡æ•°å°äºç­‰äºå½“å‰ -- å‡æ
            // 2. å¯¹äºå…¶ä»–è·¯å¾„åˆ°è¾¾æ­¤ç‚¹ï¼Œä¸”ç”šäºæ¶ˆé™¤éšœç¢ç‰©æ¬¡æ•°å¤§äºå½“å‰å€¼ -- å–ä»£å¹¶å…¥é˜Ÿ
            visited[0][0] = k;
            Queue<Point> queue = new LinkedList<>();
            queue.offer(new Point(0, 0, 0));

            // å®šä¹‰å››ä¸ªæ–¹å‘ç§»åŠ¨åæ ‡
            int[][] dirs = new int[][]{{1, 0}, {-1, 0}, {0, 1}, {0, -1}};
            // BFS æœç´¢-é˜Ÿåˆ—éå†
            while (!queue.isEmpty()) {
                minSteps++;
                // BFSæœç´¢-éå†ç›¸åŒå±‚çº§ä¸‹æ‰€æœ‰èŠ‚ç‚¹
                // å½“å‰é˜Ÿåˆ—é•¿åº¦ä¸€å®šè¦åœ¨å¾ªç¯å¤–éƒ¨å®šä¹‰ï¼Œå¾ªç¯å†…éƒ¨æœ‰æ’å…¥é˜Ÿåˆ—æ“ä½œ
                int size = queue.size();
                for (int i = 0; i < size; i++) {
                    Point current = queue.poll();
                    int x = current.x;
                    int y = current.y;
                    int oneCount = current.oneCount;

                    // å¯¹å½“å‰èŠ‚ç‚¹å››ä¸ªæ–¹å‘è¯†åˆ«å¤„ç†
                    for (int[] dir : dirs) {
                        int newX = x + dir[0];
                        int newY = y + dir[1];
                        // è¶Šç•Œåˆ¤æ–­
                        if (newX < 0 || newX >= m || newY < 0 || newY >= n) {
                            continue;
                        }
                        // æœç´¢åˆ°ç›®æ ‡èŠ‚ç‚¹ç›´æ¥è¿”å›ç»“æœï¼ŒæŒ‰å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼Œå±‚çº§å°±æ˜¯æœ€çŸ­æ­¥æ•°
                        if (newX == m - 1 && newY == n - 1) {
                            return minSteps;
                        }

                        // ç©¿è¶Šéšœç¢æ¬¡æ•°å·²æ»¡
                        if (grid[newX][newY] == 1 && oneCount >= k) {
                            continue;
                        }
                        int oneCountNew = grid[newX][newY] == 1 ? oneCount + 1 :oneCount;
                        // å‰ªæ-èŠ‚ç‚¹å·²ç»è®¿é—®è¿‡ï¼Œä¸”å½“å‰ visitedè®°å½•çš„å‰©ä½™éšœç¢ç‰©æ¶ˆé™¤æ¬¡æ•° >= å½“å‰æœç´¢èŠ‚ç‚¹å±‚çº§çš„å‰©ä½™æ¶ˆé™¤æ¬¡æ•°
                        if (visited[newX][newY] != -1 && visited[newX][newY] >= k - oneCountNew) {
                            continue;
                        }
                        else {
                            // å¦åˆ™ï¼Œè´ªå¿ƒå°†æœ€ä¼˜å€¼æ›´æ–°ï¼Œ å¹¶å°†è¯¥å±‚èŠ‚ç‚¹å…¥é˜Ÿ
                            visited[newX][newY] = k - oneCountNew;
                        }
                        queue.offer(new Point(newX, newY, oneCountNew));
                    }
                }
            }
            // BFS æ²¡æœ‰æœç´¢åˆ°ç›®æ ‡ï¼Œè¿”å›-1
            return -1;
        }

        boolean validateInputParams(int k, int m, int n) {
            return m > 40 || m < 1 || n > 40 || n < 1 || k < 1 || k > m * n;
        }

        class Point{
            int x;
            int y;
            int oneCount;

            public Point(int x, int y, int oneCount) {
                this.x = x;
                this.y = y;
                this.oneCount = oneCount;
            }
        }
    }
}
